FROM golang:alpine3.19 AS build

WORKDIR /usr/src/app

COPY . .

RUN cd /usr/src/app/cmd/ais && go build .


FROM golang:alpine3.19

WORKDIR /usr/src/app

COPY --from=build ["/usr/src/app/cmd/ais/ais", "./"]

# postgres
ENV POSTGRES_HOST=$POSTGRES_HOST
ENV POSTGRES_USER=$POSTGRES_USER
ENV POSTGRES_PASSWORD=$POSTGRES_PASSWORD
ENV POSTGRES_PORT=$POSTGRES_PORT
ENV POSTGRES_DB=$POSTGRES_DB

# rabbitmq
ENV RABBITMQ_HOST=$RABBITMQ_HOST
ENV RABBITMQ_USER=$RABBITMQ_USER
ENV RABBITMQ_PASSWORD=$RABBITMQ_PASSWORD
ENV RABBITMQ_TOPIC=$RABBITMQ_TOPIC
ENV RABBITMQ_PORT=$RABBITMQ_PORT


CMD ["./ais"]
