FROM golang:1.22-alpine AS build

WORKDIR /ais_api

COPY . .

RUN go install github.com/air-verse/air@latest

# environment
ENV AIS_ENV=$AIS_ENV
ENV PORT=$PORT

# postgres
ENV POSTGRES_HOST=$POSTGRES_HOST
ENV POSTGRES_USER=$POSTGRES_USER
ENV POSTGRES_PASSWORD=$POSTGRES_PASSWORD
ENV POSTGRES_PORT=$POSTGRES_PORT
ENV POSTGRES_DB=$POSTGRES_DB

# rabbitmq
ENV RABBITMQ_HOST=$RABBITMQ_HOST
ENV RABBITMQ_USER=$RABBITMQ_USER
ENV RABBITMQ_PASSWORD=$RABBITMQ_PASSWORD
ENV RABBITMQ_TOPIC=$RABBITMQ_TOPIC
ENV RABBITMQ_PORT=$RABBITMQ_PORT

EXPOSE $PORT

CMD ["air", "-c", ".air.toml"]
